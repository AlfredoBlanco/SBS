import { Box, Button, Container } from '@mui/material';
import type { NextPage } from 'next';
import Head from 'next/head';
import axios from 'axios'; 
import socket from '../src/socket';
import { useEffect, useState } from 'react';
import Card from '../src/components/Card';

interface Data{
  _id : string,
  title : string,
  image : string,
  description : string,
  price : number,
  stock : boolean
}

/* https://www.mongodb.com/docs/drivers/node/current/usage-examples/changeStream/
trigger an alert when is a change in a database mongodbqwef */
const Home: NextPage = () => {
  const[data, setData] = useState<Data[]>([]);
  
  socket.on('server:changes', async () => setData(await axios.get('http://localhost:3001/').then(r => r.data)));

  useEffect(() => {

    const fetchData = async() => {
      setData(await axios.get('http://localhost:3001/').then(r => r.data));
    }
    fetchData();

  }, [])

  return (
    
    <Box
      display='flex'
      flexDirection='column'
      alignItems='center'
      sx={{width : '100vw', height : '100vh'}}
      >
      <Head>
        <title>Web-A</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <h1>Lista de precios</h1>
      
      <Box
        display='flex'
        justifyContent='space-around'
        alignItems='center'
        flexWrap='wrap'
        border={1}
        sx={{width : '80vw', minHeight : 'max-content'}}
      >
        {
            data?.map((e : Data) => {
              
              return <Card key={e._id} data={e} /> 
          })
        }

      </Box>
      
      

      
    </Box>
  )
}

/* export const getServerSideProps : GetServerSideProps = async () => {
  const data : Props = await axios.get('http://localhost:3001/').then(r  => r.data);
  return {
    props : {data}
  }
} */

export default Home
